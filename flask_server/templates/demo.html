{% extends 'layout.html' %}

{% block body %}
    {# https://stackoverflow.com/questions/23273216/how-to-display-data-from-a-json-object-with-sigma-js #}

    <p>aLorem ipsum dolor sit amet, consectetur adipisicing elit. Dolorum eos eveniet ullam. Adipisci at autem
        blanditiis
        commodi cum fugit, incidunt iure laboriosam nihil officiis provident similique sit ullam, veniam voluptates!</p>
    {% if not show_result %}
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Your query graph (json format):
                    </div>
                    <div class="card-body">
                        <form id="query_form" action="{{ url_for('query') }}" method="post">
            <textarea id="query_input" rows="20" class="form-control" style="min-width: 100%" name="query">
            </textarea>
                        </form>
                    </div>
                </div>

            </div>
            <div class="col-md-6">

                <div class="card">
                    <div class="card-header">
                        graph:
                    </div>
                    <div class="card-body">
                        <div style="height: 300px" id="query-container"></div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="clearfix">
            <button class="btn btn-primary float-md-right" id="query_button">Execute query</button>
        </div>


        <script>
            const query_string_0 = '1 10 1222660; 10; 11; 0; 0; 0; 0; 1; 0; 0; 0; 1; 0; 0 6 1; 1 6 1; 1 3 1; 1 7 1; 2 8 1; 2 9 1; 3 4 1; 4 5 1; 5 6 1; 6 8 1; 7 9 1;'
            const query_string = '{\n' +
                '  "nodes": [\n' +
                '    {\n' +
                '      "id": "n0",\n' +
                '      "label": "A node",\n' +
                '      "x": 0,\n' +
                '      "y": 0,\n' +
                '      "size": 3\n' +
                '    },\n' +
                '    {\n' +
                '      "id": "n1",\n' +
                '      "label": "Another node",\n' +
                '      "x": 3,\n' +
                '      "y": 1,\n' +
                '      "size": 2\n' +
                '    },\n' +
                '    {\n' +
                '      "id": "n2",\n' +
                '      "label": "And a last one",\n' +
                '      "x": 1,\n' +
                '      "y": 3,\n' +
                '      "size": 1\n' +
                '    }\n' +
                '  ],\n' +
                '  "edges": [\n' +
                '    {\n' +
                '      "id": "e0",\n' +
                '      "source": "n0",\n' +
                '      "target": "n1"\n' +
                '    },\n' +
                '    {\n' +
                '      "id": "e1",\n' +
                '      "source": "n1",\n' +
                '      "target": "n2"\n' +
                '    },\n' +
                '    {\n' +
                '      "id": "e2",\n' +
                '      "source": "n2",\n' +
                '      "target": "n0"\n' +
                '    }\n' +
                '  ]\n' +
                '}';
            $(document).ready(function () {
                $('#query_input').val(query_string_0);
                var s = new sigma({
                    graph: JSON.parse(query_string),
                    container: 'query-container',
                    settings: {
                        defaultNodeColor: '#2a0c8d',
                        drawLabels: true,
                        labelThreshold: 0
                    }
                });
                $('#query_button').on('click', function () {
                    $('#query_form').submit();
                });

            });
        </script>
    {% else %}
        <style type="text/css">
            .result {
                height: 250px;
            }
        </style>
        {#        https://stackoverflow.com/questions/60183002/how-to-do-pagination-for-bootstrap-grid #}
        <div class="clearfix"><h3 class="float-md-left">Query results</h3><a href="{{ url_for('demo') }}"
                                                                              class="btn btn-primary float-md-right"
                                                                              id="new_query">Make
            Another Query</a></div>
        <br>
        Returned {{ num_results }} graphs:
        <br><br>
        {% for result_type in results_type_list %}
            {% if result_type['start_div'] %}
                <div class="row">
            {% endif %}
        <div class="col-md-4">
            <div class="result" id="result{{ result_type['idx'] }}"></div>
        </div>
        {% if result_type['end_div'] %}
            </div>
            <br>
        {% endif %}
        {% endfor %}

        <br>
        <nav aria-label="Page navigation example">
            <ul class="pagination">
                <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">Next</a></li>
            </ul>
        </nav>
        <script>

            $(document).ready(function () {

                {% for result_type in results_type_list %}
                    {% if not result_type['dummy_div'] %}
                        var s{{ result_type['idx'] }} = new sigma({
                            graph: {{ result_type['graph'] | safe }},
                            container: 'result{{ result_type['idx'] }}',
                            settings: {
                                defaultNodeColor: '#2a0c8d',
                                drawLabels: true,
                                labelThreshold: 0
                            }
                        });
                    {% endif %}
                {% endfor %}


            });
        </script>
    {% endif %}

    <script src="{{ url_for('static', filename='sigma.js/build/sigma.min.js') }}"></script>
    <script src="{{ url_for('static', filename='sigma.js/build/plugins/sigma.parsers.json.min.js') }}"></script>
{% endblock %}